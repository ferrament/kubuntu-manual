language: ruby
sudo: required
dist: trusty

before_install:
- sudo apt-get -qq update
- sudo apt-get -y install python3-pip texlive-full
- sudo pip3 install --upgrade pip
- sudo pip3 install sphinx
- sudo pip3 install sphinx_bootstrap_theme

env:
  - COMMAND="make clean html latexpdf epub"
  
before_deploy: 
  "mv build/latex/KubuntuManual.pdf build/latex/KubuntuManual-18.04.pdf
  && mv build/epub/KubuntuManual.epub build/epub/KubuntuManual-18.04.epub"
  
deploy:
  provider: releases
  api-key:
    secure: SxSBJ+Qs2jt87JiBMcacdW3Opt8YUe11U0k1f99zoBUAljAiWVxAKHZOpy/miNFgSsWUAejG6GzuAha1AXYGMErYEO5SnUCAwsHd4VL/lU/ZBpiOg6G2qovMzmCyhNI+ISVpAIMMhJOnx1B79x9Kt/ZM+MX1eJvYm30Gnb15kM9exEOm4nBR1OWLJYo/BlSVfEmtIOQlR5KZrqKkwP/lHnqt1rECdxvN6C3HNDaB9WGlo1825emSJy9JX4Dn4F4lkMqLNkoAvcdsLWnIAyi8FHQMJWgFvSNJ2RMy7k+El4OvRCCXcgTuVkyNvAzh0SSUWU3GaQUJs+9DtgDk3q7qZvOdmwanYj/WS3cwKljBjJlkDSqM+KdrzQcANwb7xtsLn6Qz6d/9s0oIbhixuCh1GBvcNrVbGDalUBrQ+jqGfVJACMbXaW3PMpIwfWSNLMvdEw7ypmOQ2rQE+9tBi5WIExpQf10KM3a7QWr79V5y5gAW56o3r11dpbIdiJ9bft0dl1Wc5we9TpSCwAx9+YWDt7gQmcuRoDbAfmh0GiZYMa7n1zh/xtbeilfJQqcmFOYFWGXIPndUj6VUwVy6iJ68uZZ7fc4BlBQdhdFVXwBBvFjVBDjNGey0w/0uxNaUPGjF02a1P8JmuDJ+fhDg8c7eH9oat+NzHqAKbVKeRVheCFY=
  file: 
  - "build/epub/KubuntuManual-18.04.epub"
  - "build/latex/KubuntuManual-18.04.pdf"
  skip_cleanup: true
  on:
    tags: true
    branch: kubuntu-18.04-LTS
notifications:
  email:
  - aaronhoneycutt@kubuntu.org
  slack: kubuntu:puzVpRNriVEjjGOmGqvws9FU
script:
- bash -c "$COMMAND"
