language: ruby
sudo: required
dist: trusty

before_install:
- sudo apt-get -qq update
- sudo apt-get -y install python3-pip texlive-full
- sudo pip3 install --upgrade pip
- sudo pip3 install sphinx
- sudo pip3 install sphinx_bootstrap_theme

env:
  - COMMAND="make clean html latexpdf epub"
  
before_deploy: 
  "mv build/latex/KubuntuManual.pdf build/latex/KubuntuManual-18.04.pdf
  && mv build/epub/KubuntuManual.epub build/epub/KubuntuManual-18.04.epub"
  
deploy:
  provider: releases
  api-key:
    secure: "Ou2V7wU8Vo4AreHdCTlDkV6RlkRBdLKDpy2iLfuNW+R377z0zpIR1yFHnlC9EzhmbAld18gzNKrp5fCkip/aIwErX9AkpkF1fB9Sx1KtYcnFbSFVaxDz81YXnB/M4SwS3T9VOIXMwmJj6o3eKxntJprJP+A+nZfrMq4oafdTyF7JwupH0Yu0j4qVageOX+aQXMPQ5ZQBf2VhpQKkJtupK9Nlg/QhvxBTNxcbhhzXwZTDxmSrUR/rRE5ljEZtZytHvRiRCVeCNCayKi1ZmuALLfT/DudPqFvtn1TXQWNZmydHvOJIZ7KGyAvyG/4F4sYDi29zrNt0WJtObvNOC2Ez/22SDYIQIj0i88HPv1Fhs7+D4je6Gj3l5NyF1kpjIIZUg7rPdniIlzmNTnmH/wgjtifoZnZP+39mT91X/t+Lk4JPtwfsjEGcLHMqiuNm1CDQlRJZz8uW22UImGbXdkfTEQWbie/YfLPyzwIJN5Sxo7QXb8k9ziLpgTSeDXCxOxZDe4EAietqGdLRcmbS+xqfR7v7MIzlB5nyybNP2WiyTVyu/7zdxzMNqzxQRBq1Mt9foQFly69irk+mvTDhcBHgZpqThhW+81hSx9GatgHh3woycTrhiLMJpV1TYluOGc8LfupCU6wn6ZzTlhjaObizrpfQG8ZMtqBtkmEeswMgpYs="
  file: 
  - "build/epub/KubuntuManual-18.04.epub"
  - "build/latex/KubuntuManual-18.04.pdf"
  skip_cleanup: true
  on:
    tags: true
    branch: kubuntu-18.04-LTS
notifications:
  email:
  - aaronhoneycutt@kubuntu.org
  slack: kubuntu:puzVpRNriVEjjGOmGqvws9FU
script:
- bash -c "$COMMAND"
